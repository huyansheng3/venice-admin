webpackJsonp([20],{"8zV8":function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.goodsCategory-container[data-v-1d5781cc] {\n  padding: 15px;\n}\n",""])},SA1m:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"",""])},Z0qR:function(e,t,a){var n=a("8zV8");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("rjj0")("956bb702",n,!0)},iRLE:function(e,t,a){var n=a("SA1m");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("rjj0")("7c39cc00",n,!0)},uIkv:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("//Fk"),r=a.n(n),i=a("Xxa5"),l=a.n(i),o=a("exGp"),s=a.n(o),d={data:function(){return{fullscreenLoading:!1,Form:{id:"",name:"",parentId:"",desc:""},uploadFile:{dialogImageUrl:"",dialogVisible:!1,uploadImageList:[]},categoryData:{categoryTree:[],defaultCategory:{Id:[],label:""},dialogTreeVisible:!1}}},watch:{},components:{},computed:{},methods:{handleNodeClick:function(e){this.Form.id=e.id,this.Form.name=e.label,this.Form.parentId=e.parentId,this.Form.desc=e.desc,this.uploadFile.uploadImageList=e.img_url,this.$refs.categoryTree.setCheckedKeys([e.id]),this.categoryData.defaultCategory.label=e.label+"  ["+e.id+"]",this.categoryData.defaultCategory.Id=[e.id]},handleUploadSuccess:function(e,t,a){this.uploadFile.uploadImageList=a},handleUploadRemove:function(e,t){this.uploadFile.uploadImageList=t},editCategory:function(){var e=this;return s()(l.a.mark(function t(){var a,n,r;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.fullscreenLoading=!0,a={Id:e.$route.params.id,categoryId:e.Form.id,category_info:{Id:e.Form.id,name:e.Form.name,image_url:e.uploadFile.uploadImageList,parentId:e.Form.parentId,desc:e.Form.desc}},n=window.document.getElementsByClassName("el-upload-list__item is-ready"),r=window.document.getElementsByClassName("el-upload-list__item is-success"),!(n.length>0)){t.next=9;break}return t.next=7,e.successUploadFile(n,r);case 7:a.category_info.image_url=[],e.uploadFile.uploadImageList.map(function(e,t,n){a.category_info.image_url.push({name:e.name,url:e.url.indexOf("blob")>-1?e.response.Data[0].filename:e.url})});case 9:e.$store.dispatch("EditShopCategory",a).then(function(t){e.fullscreenLoading=!1,e.$message.success("修改成功"),e.initData()});case 10:case"end":return t.stop()}},t,e)}))()},handlePictureCardPreview:function(e){this.uploadFile.dialogImageUrl=e.url,this.uploadFile.dialogVisible=!0},successUploadFile:function(e,t){var a=this;return new r.a(function(n,r){a.$refs.uploadImages.submit();var i=setInterval(function(){if(e.length===a.uploadFile.uploadImageList.length-t.length)return clearInterval(i),n()},1e3)})},renderCategoryControl:function(e,t){var a=this,n=t.node,r=t.data;t.store;return e("span",{style:"flex: 1; display: flex; align-items: center; justify-content: space-between; font-size: 14px; padding-right: 8px;"},[e("span",null,[e("span",null,[n.label])]),e("span",null,[e("el-button",{style:"font-size: 12px;",attrs:{type:"text"},on:{click:function(){return a.addCategoryTree(r)}}},["添加"]),0!=r.parentId?e("el-button",{style:"font-size: 12px;",attrs:{type:"text"},on:{click:function(){return a.removeCategoryTree(r)}}},["删除"]):""])])},addCategoryTree:function(e){var t=this;this.$confirm("确认再"+e.label+" 节点下添加一个新节点吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.fullscreenLoading=!0,t.$store.dispatch("AddShopCategory",{Id:t.$route.params.id,category_info:{name:"新的节点",parentId:e.id,image_url:[],desc:"新的节点"}}).then(function(e){t.fullscreenLoading=!1,t.$message.success("添加成功"),t.initData()})})},removeCategoryTree:function(e){var t=this;this.$confirm("此操作将删除"+e.label+" 节点下的全部信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.fullscreenLoading=!0,t.$store.dispatch("DeleteShopCategory",{Id:t.$route.params.id,categoryId:e.id}).then(function(e){t.fullscreenLoading=!1,t.$message.success("已删除"),t.initData()})})},initData:function(){var e=this;return s()(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$route.params.id){t.next=2;break}return t.abrupt("return",e.$message.error("Id有误"));case 2:e.fullscreenLoading=!0,e.$store.dispatch("GetShopInfo",{Id:e.$route.params.id}).then(function(t){e.fullscreenLoading=!1;var a=t.Data.category_info,n=[];a.map(function(t,a,r){t.Id==e.categoryData.defaultCategory.Id&&(e.categoryData.defaultCategory.label=t.name+"  ["+t.Id+"]"),0==t.parentId&&n.push({label:t.name,id:t.Id,parentId:t.parentId,desc:t.desc,img_url:t.image_url,children:[]})}),n.map(function(e,t,n){a.map(function(t,a,n){t.parentId==e.id&&e.children.push({label:t.name,id:t.Id,parentId:t.parentId,desc:t.desc,img_url:t.image_url,children:[]})}),e.children.map(function(e){a.map(function(t,a,n){t.parentId==e.id&&e.children.push({label:t.name,parentId:t.parentId,id:t.Id,img_url:t.image_url,desc:t.desc,children:[]})})})}),e.categoryData.categoryTree=n},function(e){});case 4:case"end":return t.stop()}},t,e)}))()}},mounted:function(){this.initData()}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"goodsCategory-container"},[a("el-row",{attrs:{type:"flex",justify:"left",align:"center"}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[a("el-tree",{ref:"categoryTree",attrs:{"node-key":"id","highlight-current":"","default-checked-keys":e.categoryData.defaultCategory.Id,data:e.categoryData.categoryTree,accordion:"","render-content":e.renderCategoryControl},on:{"node-click":e.handleNodeClick}})],1)]),e._v(" "),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple-light"},[a("el-form",{ref:"ruleForm",staticClass:"card-box admin-form",attrs:{model:e.Form,"label-position":"left"}},[a("el-form-item",{attrs:{label:"节点Id",prop:"id","label-width":"80px"}},[a("el-input",{attrs:{readonly:!0,disabled:!0},model:{value:e.Form.id,callback:function(t){e.$set(e.Form,"id",t)},expression:"Form.id"}})],1),e._v(" "),a("el-form-item",{attrs:{rules:[{required:!0,message:"名称不能为空"}],label:"名称",prop:"name","label-width":"80px"}},[a("el-input",{model:{value:e.Form.name,callback:function(t){e.$set(e.Form,"name",t)},expression:"Form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{rules:[{required:!0,message:"Id不能为空"}],label:"父节点Id",prop:"parentId","label-width":"80px"}},[a("el-input",{model:{value:e.Form.parentId,callback:function(t){e.$set(e.Form,"parentId",t)},expression:"Form.parentId"}})],1),e._v(" "),a("el-form-item",{attrs:{rules:[{required:!0,message:"描述不能为空"}],label:"描述",prop:"desc","label-width":"80px"}},[a("el-input",{model:{value:e.Form.desc,callback:function(t){e.$set(e.Form,"desc",t)},expression:"Form.desc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"轮播图",prop:"avatar","label-width":"80px"}},[a("el-upload",{ref:"uploadImages",attrs:{action:"http://awei.fun:3333/Unit/uploadfile","list-type":"picture-card",multiple:!0,limit:3,"file-list":e.uploadFile.uploadImageList,autoUpload:!1,"on-remove":e.handleUploadRemove,onPreview:e.handlePictureCardPreview,onSuccess:e.handleUploadSuccess,onExceed:function(){e.$message.error("商品轮播图不能超过三张")}}},[a("i",{staticClass:"el-icon-plus"})])],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:e.editCategory}},[e._v("修改")])],1)],1)],1)])],1),e._v(" "),a("el-dialog",{attrs:{visible:e.uploadFile.dialogVisible,size:"tiny"},on:{"update:visible":function(t){e.$set(e.uploadFile,"dialogVisible",t)}}},[a("img",{attrs:{width:"100%",src:e.uploadFile.dialogImageUrl,alt:""}})])],1)},staticRenderFns:[]};var u=a("VU/8")(d,c,!1,function(e){a("Z0qR"),a("iRLE")},"data-v-1d5781cc",null);t.default=u.exports}});