webpackJsonp([19],{"+dg5":function(e,t,a){var r=a("rgEz");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a("rjj0")("2c73509b",r,!0)},"0yiO":function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"",""])},Annz:function(e,t,a){var r=a("0yiO");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a("rjj0")("3d5a77ae",r,!0)},rgEz:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.edit-container {\n  padding: 15px;\n  width: 100%;\n}\n#editor {\n  min-height: 350px;\n}\n.is-checked {\n  background: #f0f7ff !important;\n}\n",""])},xY7x:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Xxa5"),l=a.n(r),o=a("exGp"),i=a.n(o),s=a("//Fk"),n=a.n(s),c=a("95YI"),u=a.n(c),d=a("TIfe"),m={data:function(){return{fullscreenLoading:!1,uploadFile:{dialogImageUrl:"",dialogVisible:!1,uploadImageList:[]},categoryData:{categoryTree:[{label:"一级 1",children:[{label:"二级 1-1",children:[{label:"三级 1-1-1"}]}]}],defaultCategory:{Id:[27786],label:""},dialogTreeVisible:!1},Form:{productName:"",content:"",newContent:"",summary:"",stocks:"",price:"",imageUrl:[],status:"",GoodsStatus:[{value:"1",label:"上架中"},{value:"9",label:"已下架"}]}}},watch:{},components:{VDistpicker:u.a},computed:{},methods:{handleNodeClick:function(e){this.$refs.categoryTree.setCheckedKeys([e.id]),this.categoryData.defaultCategory.label=e.label+"  ["+e.id+"]",this.categoryData.defaultCategory.Id=[e.id]},handleUploadSuccess:function(e,t,a){this.uploadFile.uploadImageList=a},handleUploadRemove:function(e,t){this.uploadFile.uploadImageList=t},handlePictureCardPreview:function(e){this.uploadFile.dialogImageUrl=e.url,this.uploadFile.dialogVisible=!0},successUploadFile:function(e,t){var a=this;return new n.a(function(r,l){a.$refs.uploadImages.submit();var o=setInterval(function(){if(e.length===a.uploadFile.uploadImageList.length-t.length)return clearInterval(o),r()},1e3)})},editGoods:function(){var e=this;return i()(l.a.mark(function t(){var a,r,o;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.Form.status){t.next=2;break}return t.abrupt("return",e.$message.error("请选择商品状态"));case 2:if(e.Form.imageUrl){t.next=4;break}return t.abrupt("return",e.$message.error("请至少上传一张商品轮播图"));case 4:if(e.Form.productName){t.next=6;break}return t.abrupt("return",e.$message.error("请填写商品名称"));case 6:if(e.Form.summary){t.next=8;break}return t.abrupt("return",e.$message.error("请填写商品详情"));case 8:if(e.Form.stocks){t.next=10;break}return t.abrupt("return",e.$message.error("请填写商品库存"));case 10:if(e.Form.price){t.next=12;break}return t.abrupt("return",e.$message.error("请填写商品价格"));case 12:if(e.fullscreenLoading=!0,a={Id:e.$route.params.id,status:e.Form.status,AdminToken:Object(d.a)(),productName:e.Form.productName,categoryId:e.categoryData.defaultCategory.Id[0],summary:e.Form.summary,stocks:e.Form.stocks,price:e.Form.price},r=window.document.getElementsByClassName("el-upload-list__item is-ready"),o=window.document.getElementsByClassName("el-upload-list__item is-success"),!(r.length>0)){t.next=23;break}return t.next=19,e.successUploadFile(r,o);case 19:a.image_url=[],e.uploadFile.uploadImageList.map(function(e,t,r){a.image_url.push({name:e.name,url:e.url.indexOf("blob")>-1?e.response.Data[0].filename:e.url})}),t.next=24;break;case 23:a.image_url=e.uploadFile.uploadImageList;case 24:e.Form.newContent&&(a.content=e.Form.newContent),e.$store.dispatch("EditGoods",a).then(function(t){e.fullscreenLoading=!1,e.$message.success("修改成功"),e.$store.dispatch("GoodsList",{pageIndex:1,pageSize:10}),setTimeout(function(){e.$router.go(-1)},1e3)},function(t){e.fullscreenLoading=!1});case 27:case"end":return t.stop()}},t,e)}))()},initData:function(){var e=this;return i()(l.a.mark(function t(){var a,r;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$route.params.id){t.next=2;break}return t.abrupt("return",e.$message.error("商品Id有误"));case 2:return e.fullscreenLoading=!0,e.$store.dispatch("GetProduct",{ProductNo:e.$route.params.id}).then(function(t){e.Form.content=t.Data.content,e.Form.productName=t.Data.productName||"",e.Form.summary=t.Data.summary||"",e.Form.stocks=t.Data.stocks||"",e.Form.price=t.Data.price||"",e.Form.imageUrl=t.Data.image_url||"",e.Form.status=t.Data.status||"",e.categoryData.defaultCategory.Id=[t.Data.categoryId],e.uploadFile.uploadImageList=t.Data.image_url,e.fullscreenLoading=!1},function(e){}),t.next=6,e.$store.dispatch("GetAllCategory");case 6:a=t.sent,r=[],a.Data.map(function(t,a,l){t.Id==e.categoryData.defaultCategory.Id&&(e.categoryData.defaultCategory.label=t.name+"  ["+t.Id+"]"),0==t.parentId&&r.push({label:t.name,id:t.Id,parentId:t.parentId,desc:t.desc,children:[]})}),r.map(function(e,t,r){a.Data.map(function(t,a,r){t.parentId==e.id&&e.children.push({label:t.name,id:t.Id,parentId:t.parentId,desc:t.desc,children:[]})}),e.children.map(function(e){a.Data.map(function(t,a,r){t.parentId==e.id&&e.children.push({label:t.name,parentId:t.parentId,id:t.Id,desc:t.desc,children:[]})})})}),e.categoryData.categoryTree=r;case 11:case"end":return t.stop()}},t,e)}))()}},beforeDestroy:function(){},mounted:function(){this.initData()}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"edit-container"},[a("el-form",{ref:"ruleForm",staticClass:"card-box admin-form",attrs:{model:e.Form,"label-position":"left"}},[a("el-form-item",{attrs:{rules:[{required:!0,message:"商品名称不能为空"},{min:5,message:"商品名称不能小于5位"}],label:"商品名称",prop:"productName","label-width":"80px"}},[a("el-input",{model:{value:e.Form.productName,callback:function(t){e.$set(e.Form,"productName",t)},expression:"Form.productName"}})],1),e._v(" "),a("el-form-item",{attrs:{rules:[{required:!0,message:"商品简介不能为空"},{min:5,message:"商品简介不能小于5位"}],label:"商品简介",prop:"summary","label-width":"80px"}},[a("el-input",{model:{value:e.Form.summary,callback:function(t){e.$set(e.Form,"summary",t)},expression:"Form.summary"}})],1),e._v(" "),a("el-form-item",{attrs:{rules:[{required:!0,message:"商品库存不能为空"}],label:"商品库存",prop:"stocks","label-width":"80px"}},[a("el-input",{model:{value:e.Form.stocks,callback:function(t){e.$set(e.Form,"stocks",t)},expression:"Form.stocks"}})],1),e._v(" "),a("el-form-item",{attrs:{rules:[{required:!0,message:"商品价格不能为空"}],label:"商品价格",prop:"price","label-width":"80px"}},[a("el-input",{model:{value:e.Form.price,callback:function(t){e.$set(e.Form,"price",t)},expression:"Form.price"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"商品状态",prop:"status","label-width":"80px"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.Form.status,callback:function(t){e.$set(e.Form,"status",t)},expression:"Form.status"}},e._l(e.Form.GoodsStatus,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.label))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.value))])])}))],1),e._v(" "),a("el-form-item",{attrs:{label:"商品目录",prop:"content","label-width":"80px"}},[a("div",{staticClass:"selectedCategory el-select",on:{click:function(){return e.categoryData.dialogTreeVisible=!0}}},[a("div",{staticClass:"el-input el-input--suffix"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.categoryData.defaultCategory.label,expression:"categoryData.defaultCategory.label"}],staticClass:"el-input__inner",attrs:{autocomplete:"off",placeholder:"请选择",size:"",readonly:"readonly",type:"text",rows:"2"},domProps:{value:e.categoryData.defaultCategory.label},on:{input:function(t){t.target.composing||e.$set(e.categoryData.defaultCategory,"label",t.target.value)}}}),e._v(" "),a("span",{staticClass:"el-input__suffix"},[a("span",{staticClass:"el-input__suffix-inner"},[a("i",{staticClass:"el-select__caret el-input__icon el-icon-arrow-up"})])])]),e._v(" "),a("div",{staticClass:"resize-triggers"},[a("div",{staticClass:"expand-trigger"},[a("div",{staticStyle:{width:"201px",height:"42px"}})]),e._v(" "),a("div",{staticClass:"contract-trigger"})])]),e._v(" "),a("el-dialog",{staticStyle:{"text-align":"left"},attrs:{title:"商品根目录",visible:e.categoryData.dialogTreeVisible},on:{"update:visible":function(t){e.$set(e.categoryData,"dialogTreeVisible",t)}}},[a("el-tree",{ref:"categoryTree",attrs:{"node-key":"id","default-expanded-keys":[1,2,3],"highlight-current":"","default-checked-keys":e.categoryData.defaultCategory.Id,data:e.categoryData.categoryTree,accordion:""},on:{"node-click":e.handleNodeClick}}),e._v(" "),a("el-button",{staticStyle:{width:"100%","margin-top":"30px"},attrs:{type:"primary"},on:{click:function(){return e.categoryData.dialogTreeVisible=!1}}},[e._v("确定")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"商品内容",prop:"content","label-width":"80px"}},[a("vue-html5-editor",{staticStyle:{margin:"30px 0"},attrs:{content:e.Form.content,"auto-height":!0},on:{change:function(t){return e.Form.newContent=t}}})],1),e._v(" "),a("el-form-item",{attrs:{label:"轮播图",prop:"avatar","label-width":"80px"}},[a("el-upload",{ref:"uploadImages",attrs:{action:"http://awei.fun:3333/Unit/uploadfile","list-type":"picture-card",multiple:!0,limit:5,"file-list":e.uploadFile.uploadImageList,autoUpload:!1,"on-remove":e.handleUploadRemove,onPreview:e.handlePictureCardPreview,onSuccess:e.handleUploadSuccess,onExceed:function(){e.$message.error("商品轮播图不能超过五张")}}},[a("i",{staticClass:"el-icon-plus"})])],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:e.editGoods}},[e._v("修改")])],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.uploadFile.dialogVisible,size:"tiny"},on:{"update:visible":function(t){e.$set(e.uploadFile,"dialogVisible",t)}}},[a("img",{attrs:{width:"100%",src:e.uploadFile.dialogImageUrl,alt:""}})])],1)},staticRenderFns:[]};var g=a("VU/8")(m,p,!1,function(e){a("+dg5"),a("Annz")},"data-v-1ee62faa",null);t.default=g.exports}});